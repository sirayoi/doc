=== Amazon DynamoDBのコアコンポーネント

==== Amazon DynamoDBのコアコンポーネント一覧
[cols=4,options="header", cols="15,15,40a,30a"]
|===
| コアコンポーネント | RDBでの解釈 | 内容 | 備考

| テーブル | テーブル | データのコレクション・データを保存します | テーブルに保存できる項目数に制限なし

| 項目 | レコード or タプル | テーブル内で一意に識別可能な属性のグループ（集合） | 項目が保持する属性はプライマリキーだけが必須・他は増減自由 + 
項目の最大サイズ上限:400KB

| 属性 | カラム or フィールド | データ要素であり、それ以上分割する必要がないもの | 属性が保持できる値は、<<データ型>>参照

| プライマリキー | 主キー 
| 項目を一意に識別できるキー属性のこと、単一もしくは２つの属性（キー）からなる

* １属性の場合のキー属性： パーティションキー
* ２属性の場合のキー属性： パーティションキー ＋ ソートキー 
| ２属性以上の組み合わせのプライマリキーは指定はできない

| パーディションキー | 主キーの第1キー（必須） 
| プライマリキーに必須の第1属性のこと（別名：ハッシュ属性）
| パーティションキーの属性値のハッシュコードで項目が保存されるパーティション (DynamoDB 内部の物理ストレージ) が決まる

| ソートキー | 主キーの第2キー（任意） 
| * プライマリキーの第2属性のこと、無い場合もある（別名：範囲属性）
* テーブル検索時の抽出条件の値として利用可能（逆に言うとソートキーに指定されていない属性の場合、抽出条件の設定はできず、フルスキャン後にフィルターで取捨選択することになる）
| ソートキー値で並べ替えられた順に、DynamoDB が同じパーティションキーを持つ項目同士を物理的に近くに保存する

| セカンダリインデックス | 単一テーブルからなる検索専用のマテリアライズドビュー 
| * 基本テーブルに対する検索用の別のプライマリキー（代替キー：インデックス）をオーダー順に指定したマテリアライズドビューのようなもので検索用API（Query / Scan）で利用可能
* 代替キーはプライマリキー（パーティションキー、ソートキー）からなるが、同一代替キー値で複数項目が該当するのを許容する
* グローバルとローカルの2種類作ることが出来る
| * データ実態を持つ（データを射影する） 
* 射影する属性はセカンダリインデックスの主キー属性と基本テーブルの主キー属性は必須、他の属性は任意
* 射影対象の非キー属性は、すべてのセカンダリインデックスの合計で 100個 を超えてはなりません

| ローカルセカンダリインデックス（LSI） | 同上 | * 基本テーブルと同一パーティションキーと異なるソートキーからなる代替キーを利用した検索用マテリアライズドビューのようなもの + 
* 基本テーブルの同一パーティションキー値内における検索用
| * 最大1テーブル5個
* テーブル作成後の追加不可
* パーティションキーの値ごとに 10GB のサイズ制限あり
* 検索利用時には結果整合性または強い整合性のどちらか選択可能
* 検索時は射影していない属性値も取得可能
* 基本テーブルの読み込み/書き込みユニット利用

| グローバルセカンダリインデックス（GSI） | 同上 | * 基本テーブルと異なるプライマリー（代替キー）からなる検索用のマテリアライズドビューのようなもの
| * 最大1テーブル20個
* テーブル作成後に追加可能
* サイズ制限なし 
* 検索利用時には結果整合性のみサポート
* 検索時は射影した属性値のみ取得可能
* GSI用の読み込み/書き込みユニット利用

| DynamoDB Streams | (トランザクションログのストリーミング) | テーブルのデータ変更イベントをキャプチャするオプション（ほとんどリアルタイムに、イベントの発生順にストリームに表示される） 

* 新しい項目がテーブルに追加された場合 + 
ストリームは、すべての属性を含む項目全体のイメージをキャプチャします。 + 
* 項目が更新された場合 + 
ストリームは、項目で変更された属性について、「前」と「後」のイメージをキャプチャします。
* テーブルから項目が削除された場合 + 
ストリームは、項目が削除される前に項目全体のイメージをキャプチャします。
 | DynamoDB Streams を AWS Lambda と共に使用して、トリガーを作成できる

|===

==== Amazon DynamoDBのコアコンポーネントのサンプル・イメージ図

https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html[公式の表] に補足を追加したもののイメージ

* テーブル・項目・属性のイメージ
image:./images/01-0101-01.png["テーブル・項目・属性"]

* 複合プライマリキー・グローバルセカンダリインデックスのイメージ
image:./images/01-0101-02.png["複合プライマリキー・グローバルセカンダリインデックスのイメージの補足"]

image:./images/01-0101-03.png["複合プライマリキー・グローバルセカンダリインデックスの表形式イメージ"]

* DynamoDB Streams を AWS Lambda と共に使用してトリガーを作成した際のイメージ（ https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html[公式より抜粋]）

image:./images/01-0101-04.png["DynamoDB Streams を AWS Lambda と共に使用してトリガーを作成した際のイメージ"]

